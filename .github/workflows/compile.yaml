name: Go

on: [push]

jobs:
   test-b2:
      runs-on: ubuntu-latest
      strategy:
         matrix:
            go-version: ["1.22.x", "1.23.x", "1.24.x", "1.25.x"]

      steps:
         - uses: actions/checkout@v4

         - name: Setup Go ${{ matrix.go-version }}
           uses: actions/setup-go@v5
           with:
              go-version: ${{ matrix.go-version }}

         # You can test your matrix by printing the current Go version
         - name: Run tests
           run: go test -v ./...

   transpile:
      runs-on: ubuntu-latest

      steps:
         - uses: actions/checkout@v4

         - name: Setup Go
           uses: actions/setup-go@v5
           with:
              go-version: 1.25.x

         - name: Fetch box2d sources
           run: |
              git config --global user.email "you@example.com"
              git config --global user.name "Your Name"
              ./fetch.sh

         - name: Transpile to go code
           run: ./transpile.sh

         - name: Run tests on compiled code
           run: go test -v ./...

   example:
      runs-on: ubuntu-latest

      steps:
         - uses: actions/checkout@v4

         - name: Setup Go
           uses: actions/setup-go@v5
           with:
              go-version: 1.25.x

         - name: Install dependencies
           run: |
              sudo apt-get update
              sudo apt-get install libasound2-dev libgl1-mesa-dev libxcursor-dev libxi-dev libxinerama-dev libxrandr-dev libxxf86vm-dev

         - name: Compile example
           run: go build ./example/

         - name: Compile wasm
           run: env GOOS=js GOARCH=wasm go build -v ./example/
